<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japankuru クーポンページ (最終機能完成版)</title>
    <style>
        :root {
            --primary-color: #007bff;
            --dark-blue: #1a2c4e;
            --danger-color: #d90429;
            --light-gray: #f0f2f5;
            --text-color: #333;
            --save-color: #ffc107;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--light-gray); margin: 0; color: var(--text-color);
        }
        .stylish-header {
            background-image: linear-gradient(rgba(26, 44, 78, 0.6), rgba(26, 44, 78, 0.6)), url('https://images.unsplash.com/photo-1542051841857-5f90071e7989?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: #ffffff; text-align: center; padding: 80px 20px; position: relative;
        }
        .stylish-header h1 { font-size: 52px; font-weight: 800; margin: 0 0 10px 0; text-shadow: 0 2px 10px rgba(0,0,0,0.3); animation: fadeInDown 1s ease-out; }
        .stylish-header p { font-size: 18px; opacity: 0.9; margin: 0; text-shadow: 0 1px 5px rgba(0,0,0,0.3); animation: fadeInUp 1s ease-out; }
        .coupon-container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .interaction-notice { background-color: #e3f2fd; border: 1px solid #90caf9; color: #1e3c72; padding: 15px 20px; border-radius: 12px; margin: 0 auto 40px auto; text-align: center; font-size: 16px; max-width: 800px; }
        .filter-controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 40px; flex-wrap: wrap; }
        .filter-btn { background-color: #ffffff; border: 1px solid #d1d9e6; border-radius: 20px; padding: 10px 20px; font-size: 16px; font-weight: 600; color: #555; cursor: pointer; transition: all 0.3s ease; }
        .filter-btn .count { font-size: 14px; color: #888; transition: color 0.3s; }
        .filter-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .filter-btn.active { background-color: var(--primary-color); color: #ffffff; border-color: var(--primary-color); box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3); }
        .filter-btn.active .count { color: rgba(255,255,255,0.8); }
        
        .coupon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }
        .coupon-card-scene { background-color: transparent; width: 100%; perspective: 1000px; transition: transform 0.4s ease, opacity 0.4s ease; position: relative; }
        .coupon-card-scene.is-hiding { transform: scale(0.9); opacity: 0; pointer-events: none; height: 0; margin:0; }
        .coupon-card-scene.is-hidden { display: none; }
        
        .coupon-card { display: grid; width: 100%; height: 100%; position: relative; transition: transform 0.8s; transform-style: preserve-3d; cursor: pointer; }
        .card-face { grid-row: 1 / -1; grid-column: 1 / -1; -webkit-backface-visibility: hidden; backface-visibility: hidden; background-color: #ffffff; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); display: flex; flex-direction: column; overflow: hidden; }
        .coupon-card-scene.is-flipped .coupon-card { transform: rotateY(180deg); }
        .card-face--back { transform: rotateY(180deg); padding: 20px; justify-content: space-between; }
        .card-face--front:hover { box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12); }
        .card-image-wrapper { width: 100%; aspect-ratio: 16 / 9; position: relative; overflow: hidden; background-color: #eee; }
        .card-image-wrapper img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease; }
        .card-face--front:hover .card-image-wrapper img { transform: scale(1.05); }
        .card-content { padding: 20px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; }
        .card-store-name { font-size: 20px; font-weight: bold; color: var(--dark-blue); margin: 0 0 10px 0; }
        .card-offer { font-size: 32px; font-weight: 800; color: var(--danger-color); margin: 0 0 15px 0; }
        .card-description { font-size: 15px; color: #666; margin: 0 0 15px 0; flex-grow: 1; }
        .card-tags { margin-bottom: 15px; display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; }
        .tag { background-color: #e7f1ff; color: #004aad; border: 1px solid #b3d4ff; font-size: 12px; font-weight: 600; padding: 4px 10px; border-radius: 12px; }
        .card-expiry { font-size: 14px; font-weight: 600; color: #555; background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 8px 12px; border-radius: 8px; margin: 0 auto; }
        .card-cta-button { display: flex; align-items: center; justify-content: center; gap: 10px; background-color: var(--primary-color); color: #ffffff; text-align: center; padding: 15px; text-decoration: none; font-size: 18px; font-weight: bold; margin-top: 20px; }
        
        .expiring-badge { position: absolute; top: -10px; right: -10px; background-color: var(--primary-color); color: white; padding: 10px 20px; font-size: 14px; font-weight: bold; transform: rotate(20deg); box-shadow: 0 4px 10px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.3s ease; pointer-events: none; z-index: 10; }
        .coupon-card-scene.is-expiring .expiring-badge { opacity: 1; }
        .save-btn { position: absolute; top: 10px; right: 10px; z-index: 5; background: rgba(0,0,0,0.4); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; transition: all 0.2s; line-height: 40px; padding: 0;}
        .save-btn:hover { background: rgba(0,0,0,0.6); transform: scale(1.1); }
        .save-btn.is-saved { background: var(--save-color); color: white; }
        .distance-badge { position: absolute; top: 10px; left: 10px; z-index: 5; background: rgba(0,0,0,0.6); color: white; border-radius: 8px; padding: 5px 10px; font-size: 13px; font-weight: bold; }

        .back-section { margin-bottom: 10px; text-align: left; }
        .back-section h4 { font-size: 13px; color: #999; margin: 0 0 5px 0; text-transform: uppercase; border-bottom: 1px solid #eee; padding-bottom: 3px;}
        .back-qr-code { text-align: center; margin-bottom: 10px; }
        .back-qr-code img { max-width: 120px; }
        .back-map-wrapper { width: 100%; aspect-ratio: 16 / 9; border-radius: 8px; overflow: hidden; margin-bottom: 10px; }
        .back-map-wrapper iframe { width: 100%; height: 100%; border: 0; }
        .back-info-list { list-style: none; padding: 0; margin: 0; font-size: 14px; }
        .back-info-list li { margin-bottom: 6px; }
        .back-info-list a { color: var(--primary-color); text-decoration: none; }
        .details-link-wrapper { margin-top: 15px; text-align: right; }
        .details-link { font-size: 14px; font-weight: bold; color: var(--primary-color); text-decoration: none; transition: opacity 0.2s; }
        .details-link:hover { opacity: 0.7; }
        .back-actions { display: flex; gap: 10px; margin-top: 15px; }
        .action-btn { flex: 1; padding: 12px; border-radius: 8px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        .share-btn { background-color: #ffc107; color: #333; }
        .flip-back-btn { background-color: #e9ecef; color: #555; }
        
        .site-footer { background-color: var(--dark-blue); color: rgba(255, 255, 255, 0.7); padding: 50px 20px; }
        .footer-content { max-width: 1200px; margin: 0 auto; text-align: center; }
        .footer-logo { font-size: 24px; font-weight: bold; color: #fff; margin-bottom: 15px; }
        .footer-about { max-width: 600px; margin: 0 auto 20px auto; line-height: 1.6; }
        .footer-links { margin: 20px 0; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; list-style: none; padding: 0;}
        .footer-links a { color: rgba(255, 255, 255, 0.7); text-decoration: none; transition: color 0.3s; font-size: 14px; }
        .footer-links a:hover { color: #fff; }
        .footer-copyright { font-size: 13px; margin-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 30px; }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
        /* --- 기능 필터 버튼 스타일 --- */
.filter-group { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
.filter-group::before { content: '|'; color: #d1d9e6; margin-right: 10px; }
.filter-group:first-child::before { display: none; }
.filter-btn.filter-btn--special {
    background-color: transparent;
    border-color: var(--primary-color);
    color: var(--primary-color);
}
.filter-btn.filter-btn--special.active {
    background-color: var(--primary-color);
    color: #ffffff;
    border-color: var(--primary-color);
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
}
.filter-btn.active { background-color: #6c757d; color: #ffffff; border-color: #6c757d; }
.filter-btn.active .count { color: rgba(255,255,255,0.8); }

/* --- 저장 버튼 및 거리 배지 스타일 --- */
.save-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 5;
    background: rgba(0,0,0,0.4);
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.2s;
    line-height: 40px;
    padding: 0;
}
.save-btn:hover {
    background: rgba(0,0,0,0.6);
    transform: scale(1.1);
}
.save-btn.is-saved {
    background: var(--save-color);
    color: white;
}
.distance-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 5;
    background: rgba(0,0,0,0.6);
    color: white;
    border-radius: 8px;
    padding: 5px 10px;
    font-size: 13px;
    font-weight: bold;
}
    </style>
</head>
<body>
    
    <header class="stylish-header">
        <h1>Japankuru 特別クーポン</h1>
        <p>あなたの日本旅行を、もっと特別にする割引特典をお見逃しなく！</p>
    </header>

    <div class="coupon-container">
        <div class="interaction-notice">💡 <b>ヒント:</b> 各カードをクリックすると、裏面の詳細情報とGoogleマップが確認できます！</div>
        <div class="filter-controls">
            <div class="filter-group">
                <button class="filter-btn filter-btn--special" data-filter="nearby">📍 周辺</button>
                <button class="filter-btn filter-btn--special" data-filter="saved">⭐️ 保存済み</button>
            </div>
            <div class="filter-group">
                <button class="filter-btn active" data-filter="all">すべて表示 <span class="count"></span></button>
                <button class="filter-btn" data-filter="electronics">💻 家電 <span class="count"></span></button>
                <button class="filter-btn" data-filter="fashion">👕 ファッション <span class="count"></span></button>
                <button class="filter-btn" data-filter="dining">🍜 グルメ <span class="count"></span></button>
                <button class="filter-btn" data-filter="transport">🚆 交通 <span class="count"></span></button>
            </div>
        </div>
        <div class="coupon-grid">
            
          <div class="coupon-card-scene" data-coupon-id="1" data-category="electronics" data-expiry="2025-12-31" data-lat="35.6908" data-lon="139.7028">
                <div class="expiring-badge">間もなく終了</div>
                <button class="save-btn">⭐️</button>
                <div class="coupon-card">
                    <div class="card-face card-face--front"><div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg" alt="KOJIMA クーポン"></div><div class="card-content"><h3 class="card-store-name">コジマ x ビックカメラ</h3><p class="card-offer">最大 17% OFF</p><p class="card-description">免税10% + 追加7%割引！最新の電子製品を安く手に入れよう。</p><div class="card-tags"><span class="tag">#新宿</span><span class="tag">#免税</span><span class="tag">#家電</span></div><p class="card-expiry">🕒 有効期間: 2025.12.31</p></div><div class="card-cta-button">✂️ クーポン裏面を見る</div></div>
                    <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-BIC2025" alt="QR Code"></div>
                        <div class="back-map-wrapper">
                            <iframe width="100%" height="100%" style="border:0;" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"
                                src="https://maps.google.com/maps?q=Shibuya+Udagawacho+31-1&z=15&output=embed4">
                            </iframe>
                        </div>
                        <div class="back-section"><h4>関連情報</h4><ul class="back-info-list"><li><strong>📍 住所:</strong> 東京都新宿区新宿3-29-1</li><li><strong>⏰ 営業時間:</strong> 毎日 10:00 - 22:00</li><li><strong>✨ ヒント:</strong> 8階のゲームコーナーはお子様に大人気！</li></ul></div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 共有</button><button class="action-btn flip-back-btn"><-- 表面へ戻る</button></div>
                    </div>
                </div>
            </div>

            <div class="coupon-card-scene" data-coupon-id="2" data-category="fashion" data-expiry="2025-07-30" data-lat="35.6603" data-lon="139.6983">
                 <div class="expiring-badge">間もなく終了</div>
                <button class="save-btn">⭐️</button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg" alt="JINS クーポン"></div>
                        <div class="card-content"><h3 class="card-store-name">JINS</h3><p class="card-offer">10% OFF</p><p class="card-description">日本の代表的なメガネブランドJINS！おしゃれなメガネを免税+割引で。</p><div class="card-tags"><span class="tag">#渋谷</span><span class="tag">#メガネ</span></div><p class="card-expiry">🕒 有効期間: 2025.07.30</p></div>
                        <div class="card-cta-button">✂️ クーポン裏面を見る</div>
                    </div>
                    <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-JINS2025" alt="QR Code"></div>
                        <div class="back-map-wrapper">
                           <iframe width="100%" height="100%" style="border:0;" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"
                                src="https://maps.google.com/maps?q=Shibuya+Udagawacho+31-1&z=15&output=embed5">
                           </iframe>
                        </div>
                        <div class="back-section"><h4>関連情報</h4><ul class="back-info-list"><li><strong>📍 住所:</strong> 東京都渋谷区宇田川町31-1</li><li><strong>⏰ 営業時間:</strong> 毎日 11:00 - 21:00</li><li><strong>✨ ヒント:</strong> 基本レンズは会計後、最短30分で完成！</li></ul></div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 共有</button><button class="action-btn flip-back-btn"><-- 表面へ戻る</button></div>
                    </div>
                </div>
            </div>
            
            <div class="coupon-card-scene" data-coupon-id="3" data-category="fashion" data-expiry="2025-09-30" data-lat="35.6705" data-lon="139.7073">
                <div class="expiring-badge">間もなく終了</div>
                <button class="save-btn">⭐️</button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg" alt="BEAMS クーポン"></div>
                        <div class="card-content"><h3 class="card-store-name">BEAMS JAPAN</h3><p class="card-offer">5% 追加割引</p><p class="card-description">日本の最新トレンドを発信するセレクトショップBEAMSで特別なアイテムを。</p><div class="card-tags"><span class="tag">#原宿</span><span class="tag">#ファッション</span><span class="tag">#限定版</span></div><p class="card-expiry">🕒 有効期間: 2025.09.30</p></div>
                        <div class="card-cta-button">✂️ クーポン裏面を見る</div>
                    </div>
                    <div class="card-face card-face--back">
                         <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-BEAMS25" alt="QR Code"></div>
                        <div class="back-map-wrapper">
                           <iframe width="100%" height="100%" style="border:0;" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"
                                src="https://maps.google.com/maps?q=Shibuya+Udagawacho+31-1&z=15&output=embed6">
                           </iframe>
                        </div>
                        <div class="back-section"><h4>関連情報</h4><ul class="back-info-list"><li><strong>📍 住所:</strong> 東京都渋谷区神宮前3-24-7</li><li><strong>⏰ 営業時間:</strong> 毎日 11:00 - 20:00</li><li><strong>✨ ヒント:</strong> 日本限定のコラボ商品を探してみて。</li></ul></div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 共有</button><button class="action-btn flip-back-btn"><-- 表面へ戻る</button></div>
                    </div>
                </div>
            </div>
            
            <div class="coupon-card-scene" data-coupon-id="4" data-category="dining" data-expiry="2026-03-31" data-lat="35.6970" data-lon="139.7001">
                <div class="expiring-badge">間もなく終了</div>
                <button class="save-btn">⭐️</button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/%E4%BE%8D%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3c-2_0_0-1536x864.jpeg" alt="Samurai Restaurant クーポン"></div>
                        <div class="card-content"><h3 class="card-store-name">サムライレストラン</h3><p class="card-offer">ドリンク1杯無料</p><p class="card-description">華麗なショーと共に楽しむ特別な食事！クーポン提示でドリンクをゲット。</p><div class="card-tags"><span class="tag">#新宿</span><span class="tag">#エンタメ</span></div><p class="card-expiry">🕒 有効期間: 2026.03.31</p></div>
                        <div class="card-cta-button">✂️ クーポン裏面を見る</div>
                    </div>
                    <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-SAMURAI" alt="QR Code"></div>
                        <div class="back-map-wrapper">
                            <iframe width="100%" height="100%" style="border:0;" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"
                                src="https://maps.google.com/maps?q=Shibuya+Udagawacho+31-1&z=15&output=embed7">
                            </iframe>
                        </div>
                        <div class="back-section"><h4>関連情報</h4><ul class="back-info-list"><li><strong>📍 住所:</strong> 東京都新宿区歌舞伎町2-45-8</li><li><strong>⏰ 営業時間:</strong> 毎日 18:00 - 23:30</li><li><strong>✨ ヒント:</strong> 公演時間の30分前に到着するのがおすすめ！</li></ul></div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 共有</button><button class="action-btn flip-back-btn"><-- 表面へ戻る</button></div>
                    </div>
                </div>
            </div>

            <div class="coupon-card-scene" data-coupon-id="5" data-category="transport" data-lat="35.6580" data-lon="139.7016">
                 <div class="expiring-badge">間もなく終了</div>
                 <button class="save-btn">⭐️</button>
                 <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2025/03/tokyu-cover-16-9-1-1536x864.png" alt="Tokyu Line クーポン"></div>
                        <div class="card-content"><h3 class="card-store-name">東急線</h3><p class="card-offer">1日乗車券</p><p class="card-description">東京旅行の必須アイテム！渋谷、自由が丘などを巡る東急線の1日乗車券。</p><div class="card-tags"><span class="tag">#渋谷</span><span class="tag">#交通</span><span class="tag">#乗り放題</span></div><p class="card-expiry">✅ 常時イベント</p></div>
                        <div class="card-cta-button">✂️ クーポン裏面を見る</div>
                    </div>
                    <div class="card-face card-face--back">
                         <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-TOKYU" alt="QR Code"></div>
                        <div class="back-map-wrapper">
                            <iframe width="100%" height="100%" style="border:0;" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"
                                src="https://maps.google.com/maps?q=Shibuya+Udagawacho+31-1&z=15&output=embed8">
                            </iframe>
                        </div>
                        <div class="back-section"><h4>関連情報</h4><ul class="back-info-list"><li><strong>📍 交換場所:</strong> 渋谷駅など東急線の主要駅窓口</li><li><strong>⏰ 利用時間:</strong> 始発から終電まで</li><li><strong>✨ ヒント:</strong> 下北沢、自由が丘への旅行時に特に便利！</li></ul></div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 共有</button><button class="action-btn flip-back-btn"><-- 表面へ戻る</button></div>
                    </div>
                </div>
            </div>
            
            <div class="coupon-card-scene" data-coupon-id="6" data-category="electronics" data-expiry="2025-11-30" data-lat="35.6984" data-lon="139.7745">
                <div class="expiring-badge">間もなく終了</div>
                <button class="save-btn">⭐️</button>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://img.japankuru.com/prg_img/thumbnail1/img2023112417190332724100.png" alt="Yodobashi Camera クーポン"></div>
                        <div class="card-content"><h3 class="card-store-name">ヨドバシカメラ</h3><p class="card-offer">最大 15% OFF</p><p class="card-description">免税10% + VISAカード決済で5%追加割引！カメラ、家電、ゲームまで。</p><div class="card-tags"><span class="tag">#秋葉原</span><span class="tag">#免税</span><span class="tag">#ゲーム</span></div><p class="card-expiry">🕒 有効期間: 2025.11.30</p></div>
                        <div class="card-cta-button">✂️ クーポン裏面を見る</div>
                    </div>
                     <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-Yodobashi" alt="QR Code"></div>
                        <div class="back-map-wrapper">
                           <iframe width="100%" height="100%" style="border:0;" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade"
                                src="https://maps.google.com/maps?q=Shibuya+Udagawacho+31-1&z=15&output=embed9">
                           </iframe>
                        </div>
                        <div class="back-section"><h4>関連情報</h4><ul class="back-info-list"><li><strong>📍 住所:</strong> 東京都千代田区神田花岡町1-1</li><li><strong>⏰ 営業時間:</strong> 毎日 09:30 - 22:00</li><li><strong>✨ ヒント:</strong> フィギュアやアニメグッズは6階に集結！</li></ul></div>
                        <div class="details-link-wrapper"><a href="#" class="details-link" target="_blank">詳細情報を見る →</a></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 共有</button><button class="action-btn flip-back-btn"><-- 表面へ戻る</button></div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-logo">JAPANKURU</div>
            <p class="footer-about">日本のすべてを深く、面白く。Japankuruと共にする特別な旅行。</p>
            <ul class="footer-links">
                <li><a href="#">会社紹介</a></li><li><a href="#">すべてのクーポン</a></li><li><a href="#">お問い合わせ</a></li><li><a href="#">プライバシーポリシー</a></li>
            </ul>
            <div class="footer-copyright">© 2025 Japankuru. All Rights Reserved.</div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const couponGrid = document.querySelector('.coupon-grid');
            const filterButtons = document.querySelectorAll('.filter-btn');
            let savedCouponIds = [];
        
            function initApp() {
                loadSavedCoupons();
                checkExpiryDates();
                updateFilterCounts();
                setupEventListeners();
            }
        
            function loadSavedCoupons() {
                const storedIds = localStorage.getItem('japankuruSavedCoupons');
                savedCouponIds = storedIds ? JSON.parse(storedIds) : [];
                updateSaveButtonsVisuals();
            }
        
            function updateSaveButtonsVisuals() {
                document.querySelectorAll('.save-btn').forEach(btn => {
                    const couponId = btn.closest('.coupon-card-scene').dataset.couponId;
                    btn.classList.toggle('is-saved', savedCouponIds.includes(couponId));
                });
            }
        
            function toggleSaveCoupon(couponId) {
                const index = savedCouponIds.indexOf(couponId);
                if (index > -1) savedCouponIds.splice(index, 1);
                else savedCouponIds.push(couponId);
                localStorage.setItem('japankuruSavedCoupons', JSON.stringify(savedCouponIds));
                updateSaveButtonsVisuals();
                updateFilterCounts(); // 저장된 쿠폰 개수 업데이트
                
                const savedFilter = document.querySelector('.filter-btn[data-filter="saved"]');
                if (savedFilter && savedFilter.classList.contains('active')) {
                    applyFilter(savedFilter);
                }
            }
        
            function checkExpiryDates() {
                const today = new Date();
                const threshold = 30 * 24 * 60 * 60 * 1000;
                document.querySelectorAll('.coupon-card-scene').forEach(scene => {
                    const expiryDateStr = scene.dataset.expiry;
                    if (expiryDateStr) {
                        const expiryDate = new Date(expiryDateStr);
                        const diff = expiryDate - today;
                        if (diff < threshold && diff > 0) scene.classList.add('is-expiring');
                    }
                });
            }
        
            function setupEventListeners() {
                document.querySelectorAll('.coupon-card-scene').forEach(scene => {
                    scene.addEventListener('click', (e) => {
                        if (!e.target.closest('a, iframe, .action-btn, .save-btn')) {
                             scene.classList.toggle('is-flipped');
                        }
                    });
                });
                document.querySelectorAll('.flip-back-btn').forEach(button => {
                     button.addEventListener('click', e => {
                        e.stopPropagation();
                        button.closest('.coupon-card-scene').classList.remove('is-flipped');
                    });
                });
                document.querySelectorAll('.save-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const couponId = e.target.closest('.coupon-card-scene').dataset.couponId;
                        toggleSaveCoupon(couponId);
                    });
                });
                document.querySelectorAll('.share-btn').forEach(button => {
                    button.addEventListener('click', async (e) => {
                        e.stopPropagation();
                        const card = button.closest('.coupon-card-scene');
                        const storeName = card.querySelector('.card-store-name').textContent;
                        const offer = card.querySelector('.card-offer').textContent;
                        const shareData = { title: `${storeName} 割引クーポン`, text: `Japankuruで${storeName}の${offer}クーポンをチェック！`, url: window.location.href };
                        try {
                            if (navigator.share) await navigator.share(shareData);
                            else alert('このブラウザは共有機能に対応していません。\nページのURLをコピーして共有してください。');
                        } catch (err) { console.error("Share failed:", err); }
                    });
                });
        
                document.querySelector('.filter-controls').addEventListener('click', (event) => {
                    const target = event.target.closest('.filter-btn');
                    if (!target || target.classList.contains('active')) return;
                    applyFilter(target);
                });
            }
        
            function applyFilter(clickedButton = document.querySelector('.filter-btn.active')) {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                clickedButton.classList.add('active');
                
                document.querySelectorAll('.coupon-card-scene.is-flipped').forEach(flippedScene => {
                    flippedScene.classList.remove('is-flipped');
                });
        
                // 거리 배지 초기화
                document.querySelectorAll('.distance-badge').forEach(badge => badge.remove());
                
                const filter = clickedButton.dataset.filter;
        
                if (filter === 'nearby') {
                    handleNearbyFilter();
                    return;
                }
        
                if (couponGrid.dataset.sorted === 'true') {
                    const originalOrder = Array.from(document.querySelectorAll('.coupon-card-scene')).sort((a,b) => a.dataset.couponId - b.dataset.couponId);
                    originalOrder.forEach(scene => couponGrid.appendChild(scene));
                    couponGrid.dataset.sorted = 'false';
                }
        
                document.querySelectorAll('.coupon-card-scene').forEach(scene => {
                    let shouldShow = false;
                    switch (filter) {
                        case 'all': shouldShow = true; break;
                        case 'saved': shouldShow = savedCouponIds.includes(scene.dataset.couponId); break;
                        default: shouldShow = scene.dataset.category === filter; break;
                    }
        
                    if (shouldShow) {
                        scene.classList.remove('is-hidden', 'is-hiding');
                    } else {
                        scene.classList.add('is-hiding');
                        scene.addEventListener('transitionend', () => {
                            if (scene.classList.contains('is-hiding')) scene.classList.add('is-hidden');
                        }, { once: true });
                    }
                });
            }
        
            function calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371; const dLat = (lat2 - lat1) * Math.PI / 180; const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); return R * c;
            }
        
            function handleNearbyFilter() {
                if (!navigator.geolocation) {
                    alert('お使いのブラウザは位置情報機能に対応していません。');
                    applyFilter(document.querySelector('.filter-btn[data-filter="all"]'));
                    return;
                }
        
                navigator.geolocation.getCurrentPosition(position => {
                    const userLat = position.coords.latitude; const userLon = position.coords.longitude;
                    const scenes = document.querySelectorAll('.coupon-card-scene');
                    
                    scenes.forEach(scene => {
                        scene.classList.remove('is-hidden', 'is-hiding');
                        const sceneLat = scene.dataset.lat; const sceneLon = scene.dataset.lon;
                        if (sceneLat && sceneLon) {
                            const distance = calculateDistance(userLat, userLon, sceneLat, sceneLon);
                            scene.dataset.distance = distance;
                            let distanceBadge = scene.querySelector('.distance-badge');
                            if (!distanceBadge) {
                                distanceBadge = document.createElement('div');
                                distanceBadge.className = 'distance-badge';
                                scene.appendChild(distanceBadge);
                            }
                            distanceBadge.textContent = `約 ${distance.toFixed(1)}km`;
                        }
                    });
                    const sortedScenes = Array.from(scenes).sort((a, b) => a.dataset.distance - b.dataset.distance);
                    sortedScenes.forEach(scene => couponGrid.appendChild(scene));
                    couponGrid.dataset.sorted = 'true';
                }, () => {
                    alert('位置情報の取得に失敗しました。設定を確認してください。');
                    applyFilter(document.querySelector('.filter-btn[data-filter="all"]'));
                });
            }
            
            function updateFilterCounts() {
                filterButtons.forEach(button => {
                    const filter = button.dataset.filter;
                    if (filter === 'nearby') return;
                    const count = (filter === 'all') ? document.querySelectorAll('.coupon-card-scene').length : (filter === 'saved') ? savedCouponIds.length : document.querySelectorAll(`.coupon-card-scene[data-category="${filter}"]`).length;
                    const countSpan = button.querySelector('.count');
                    if(countSpan) countSpan.textContent = ` (${count})`;
                });
            }
            
            initApp();
        });
        </script>

</body>
</html>
