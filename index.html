<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쿠폰 페이지 최종 완성본 (v3.2 - 버그 수정)</title>
    <style>
        :root {
            --primary-color: #007bff;
            --dark-blue: #1a2c4e;
            --danger-color: #d90429;
            --light-gray: #f0f2f5;
            --text-color: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--light-gray);
            margin: 0;
            color: var(--text-color);
        }

        /* 헤더 스타일 */
        .stylish-header {
            background-image: linear-gradient(rgba(26, 44, 78, 0.6), rgba(26, 44, 78, 0.6)), url('https://images.unsplash.com/photo-1542051841857-5f90071e7989?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #ffffff;
            text-align: center;
            padding: 80px 20px;
            position: relative;
        }
        .stylish-header h1 { font-size: 52px; font-weight: 800; margin: 0 0 10px 0; text-shadow: 0 2px 10px rgba(0,0,0,0.3); animation: fadeInDown 1s ease-out; }
        .stylish-header p { font-size: 18px; opacity: 0.9; margin: 0; text-shadow: 0 1px 5px rgba(0,0,0,0.3); animation: fadeInUp 1s ease-out; }

        .coupon-container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .interaction-notice { background-color: #e3f2fd; border: 1px solid #90caf9; color: #1e3c72; padding: 15px 20px; border-radius: 12px; margin: 0 auto 40px auto; text-align: center; font-size: 16px; max-width: 800px; }
        .filter-controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 40px; flex-wrap: wrap; }
        .filter-btn { background-color: #ffffff; border: 1px solid #d1d9e6; border-radius: 20px; padding: 10px 20px; font-size: 16px; font-weight: 600; color: #555; cursor: pointer; transition: all 0.3s ease; }
        .filter-btn .count { font-size: 14px; color: #888; transition: color 0.3s; }
        .filter-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .filter-btn.active { background-color: var(--primary-color); color: #ffffff; border-color: var(--primary-color); box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3); }
        .filter-btn.active .count { color: rgba(255,255,255,0.8); }
        
        .coupon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }
        .coupon-card-scene {
            background-color: transparent;
            width: 100%;
            perspective: 1000px;
            transition: transform 0.4s ease, opacity 0.4s ease;
        }
        .coupon-card-scene.is-hiding { transform: scale(0.9); opacity: 0; pointer-events: none; }
        .coupon-card-scene.is-hidden { display: none; }
        
        /* --- 버그 수정: 카드 높이 계산 구조 변경 --- */
        .coupon-card {
            display: grid; /* Grid 레이아웃 사용 */
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.8s;
            transform-style: preserve-3d;
            cursor: pointer;
        }
        .card-face {
            /* position: absolute 대신 Grid 아이템으로 배치 */
            grid-row: 1 / -1;
            grid-column: 1 / -1;
            
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* 높이가 자동으로 계산되므로 height: 100% 제거 */
        }
        /* ------------------------------------- */

        .coupon-card-scene.is-flipped .coupon-card { transform: rotateY(180deg); }
        .card-face--back { transform: rotateY(180deg); padding: 20px; justify-content: space-between; }
        .card-face--front:hover { box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12); }
        .card-image-wrapper { width: 100%; aspect-ratio: 16 / 9; position: relative; overflow: hidden; background-color: #eee; }
        .card-image-wrapper img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease; }
        .card-face--front:hover .card-image-wrapper img { transform: scale(1.05); }
        .card-content { padding: 20px; text-align: center; flex-grow: 1; display: flex; flex-direction: column; }
        .card-store-name { font-size: 20px; font-weight: bold; color: var(--dark-blue); margin: 0 0 10px 0; }
        .card-offer { font-size: 32px; font-weight: 800; color: var(--danger-color); margin: 0 0 15px 0; }
        .card-description { font-size: 15px; color: #666; margin: 0 0 15px 0; flex-grow: 1; }
        .card-expiry { font-size: 14px; font-weight: 600; color: #555; background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 8px 12px; border-radius: 8px; margin: 0 auto; }
        .card-cta-button { display: flex; align-items: center; justify-content: center; gap: 10px; background-color: var(--primary-color); color: #ffffff; text-align: center; padding: 15px; text-decoration: none; font-size: 18px; font-weight: bold; margin-top: 20px; }
        
        .expiring-badge { position: absolute; top: -10px; right: -10px; background-color: var(--danger-color); color: white; padding: 10px 20px; font-size: 14px; font-weight: bold; transform: rotate(20deg); box-shadow: 0 4px 10px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.3s ease; pointer-events: none; z-index: 10; }
        .coupon-card-scene.is-expiring .expiring-badge { opacity: 1; }

        .back-section { margin-bottom: 10px; text-align: left; }
        .back-section h4 { font-size: 13px; color: #999; margin: 0 0 5px 0; text-transform: uppercase; border-bottom: 1px solid #eee; padding-bottom: 3px;}
        .back-qr-code { text-align: center; margin-bottom: 10px; }
        .back-qr-code img { max-width: 120px; }
        .back-map-wrapper { width: 100%; aspect-ratio: 16 / 9; border-radius: 8px; overflow: hidden; margin-bottom: 10px; }
        .back-map-wrapper iframe { width: 100%; height: 100%; border: 0; }
        .back-info-list { list-style: none; padding: 0; margin: 0; font-size: 14px; }
        .back-info-list li { margin-bottom: 6px; }
        .back-info-list a { color: var(--primary-color); text-decoration: none; }
        .back-actions { display: flex; gap: 10px; margin-top: 15px; }
        .action-btn { flex: 1; padding: 12px; border-radius: 8px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        .share-btn { background-color: #ffc107; color: #333; }
        .flip-back-btn { background-color: #e9ecef; color: #555; }
        
        .site-footer { background-color: var(--dark-blue); color: rgba(255, 255, 255, 0.7); padding: 40px 20px; }
        .footer-content { max-width: 1200px; margin: 0 auto; text-align: center; }
        .footer-logo { font-size: 24px; font-weight: bold; color: #fff; margin-bottom: 15px; }
        .footer-links { margin: 20px 0; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .footer-links a { color: rgba(255, 255, 255, 0.7); text-decoration: none; transition: color 0.3s; }
        .footer-links a:hover { color: #fff; }
        .footer-copyright { font-size: 14px; margin-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 20px; }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    
    <header class="stylish-header">
        <h1>JAPANKURU Exclusive Coupons</h1>
        <p>일본 여행을 더 특별하게 만들어 줄 할인 혜택을 놓치지 마세요!</p>
    </header>

    <div class="coupon-container">
        
        <div class="interaction-notice">
            💡 <b>꿀팁:</b> 각 카드를 클릭하면 뒷면에 숨겨진 상세 정보와 구글 지도를 확인할 수 있어요!
        </div>

        <div class="filter-controls">
            <button class="filter-btn active" data-filter="all">전체보기 <span class="count"></span></button>
            <button class="filter-btn" data-filter="electronics">💻 가전제품 <span class="count"></span></button>
            <button class="filter-btn" data-filter="fashion">👕 패션 <span class="count"></span></button>
            <button class="filter-btn" data-filter="dining">🍜 맛집 <span class="count"></span></button>
            <button class="filter-btn" data-filter="transport">🚆 교통 <span class="count"></span></button>
        </div>

        <div class="coupon-grid">
            
            <div class="coupon-card-scene" data-category="electronics" data-expiry="2025-12-31">
                <div class="expiring-badge">마감임박</div>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg" alt="KOJIMA 쿠폰"></div>
                        <div class="card-content"><h3 class="card-store-name">KOJIMA x BicCamera</h3><p class="card-offer">최대 17% OFF</p><p class="card-description">면세 10% + 추가 7% 할인! 최신 전자제품을 저렴하게 구매하세요.</p><p class="card-expiry">🕒 유효기간: 2025. 12. 31</p></div>
                        <div class="card-cta-button">✂️ 쿠폰 뒷면 보기</div>
                    </div>
                    <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-BIC2025" alt="QR Code"></div>
                        <div class="back-map-wrapper">
  <iframe
    src="https://maps.google.com/maps?q=35.6900,139.7004&z=15&output=embed"
    width="100%"
    height="100%"
    style="border:0;"
    allowfullscreen=""
    loading="lazy">
  </iframe>
</div>

                        <div class="back-section"><h4>관련 정보</h4><ul class="back-info-list"><li><strong>📍 주소:</strong> 도쿄도 신주쿠구 신주쿠 3-29-1</li><li><strong>⏰ 영업시간:</strong> 매일 10:00 - 22:00</li><li><strong>✨ 팁:</strong> 8층 게임 코너는 아이들에게 인기 만점!</li></ul></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 공유하기</button><button class="action-btn flip-back-btn"><-- 앞면으로</button></div>
                    </div>
                </div>
            </div>

            <div class="coupon-card-scene" data-category="fashion" data-expiry="2025-07-25">
                 <div class="expiring-badge">마감임박</div>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/japankuru_1800-1200-1536x1024.jpg" alt="JINS 쿠폰"></div>
                        <div class="card-content"><h3 class="card-store-name">JINS</h3><p class="card-offer">10% OFF</p><p class="card-description">일본 대표 안경 브랜드 JINS! 세련된 안경을 면세 + 추가 할인 받으세요.</p><p class="card-expiry">🕒 유효기간: 2025. 07. 25</p></div>
                        <div class="card-cta-button">✂️ 쿠폰 뒷면 보기</div>
                    </div>
                    <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-JINS2025" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe src="https://maps.google.com/maps?q=ADDRESS&z=15&output=embed1" loading="lazy"></iframe></div>
                        <div class="back-section"><h4>관련 정보</h4><ul class="back-info-list"><li><strong>📍 주소:</strong> 도쿄도 시부야구 우다가와초 31-1</li><li><strong>⏰ 영업시간:</strong> 매일 11:00 - 21:00</li><li><strong>✨ 팁:</strong> 기본 렌즈는 계산 후 30분이면 완성돼요!</li></ul></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 공유하기</button><button class="action-btn flip-back-btn"><-- 앞면으로</button></div>
                    </div>
                </div>
            </div>
            
            <div class="coupon-card-scene" data-category="fashion" data-expiry="2025-09-30">
                <div class="expiring-badge">마감임박</div>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2023/11/kojima%E8%8B%B1%E8%AA%9E%E7%89%88%E4%BC%81%E6%A5%AD%E6%9C%89_kojima_EN_B-2.jpg" alt="BEAMS 쿠폰"></div>
                        <div class="card-content"><h3 class="card-store-name">BEAMS JAPAN</h3><p class="card-offer">5% 추가할인</p><p class="card-description">일본의 최신 트렌드를 담은 편집샵 BEAMS에서 특별한 아이템을 만나보세요.</p><p class="card-expiry">🕒 유효기간: 2025. 09. 30</p></div>
                        <div class="card-cta-button">✂️ 쿠폰 뒷면 보기</div>
                    </div>
                    <div class="card-face card-face--back">
                         <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-BEAMS25" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe src="https://maps.google.com/maps?q=ADDRESS&z=15&output=embed2" loading="lazy"></iframe></div>
                        <div class="back-section"><h4>관련 정보</h4><ul class="back-info-list"><li><strong>📍 주소:</strong> 도쿄도 시부야구 진구마에 3-24-7</li><li><strong>⏰ 영업시간:</strong> 매일 11:00 - 20:00</li><li><strong>✨ 팁:</strong> 일본 한정판 콜라보 상품을 찾아보세요.</li></ul></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 공유하기</button><button class="action-btn flip-back-btn"><-- 앞면으로</button></div>
                    </div>
                </div>
            </div>
            
            <div class="coupon-card-scene" data-category="dining" data-expiry="2026-03-31">
                <div class="expiring-badge">마감임박</div>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2024/06/%E4%BE%8D%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3c-2_0_0-1536x864.jpeg" alt="Samurai Restaurant 쿠폰"></div>
                        <div class="card-content"><h3 class="card-store-name">Samurai Restaurant</h3><p class="card-offer">음료 1잔 무료</p><p class="card-description">화려한 쇼와 함께 즐기는 특별한 식사! 쿠폰을 제시하고 무료 음료를 받으세요.</p><p class="card-expiry">🕒 유효기간: 2026. 03. 31</p></div>
                        <div class="card-cta-button">✂️ 쿠폰 뒷면 보기</div>
                    </div>
                    <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-SAMURAI" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe
  src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d…（中略）…"
  width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy">
</iframe>
</div>
                        <div class="back-section"><h4>관련 정보</h4><ul class="back-info-list"><li><strong>📍 주소:</strong> 도쿄도 신주쿠구 가부키초 2-45-8</li><li><strong>⏰ 영업시간:</strong> 매일 18:00 - 23:30</li><li><strong>✨ 팁:</strong> 공연 시간 30분 전에 도착하는 것을 추천!</li></ul></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 공유하기</button><button class="action-btn flip-back-btn"><-- 앞면으로</button></div>
                    </div>
                </div>
            </div>

            <div class="coupon-card-scene" data-category="transport">
                 <div class="expiring-badge">마감임박</div>
                 <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://japankuru.com/gld-kanri/data/uploads/2025/03/tokyu-cover-16-9-1-1536x864.png" alt="Tokyu Line 쿠폰"></div>
                        <div class="card-content"><h3 class="card-store-name">도큐 라인 (Tokyu Line)</h3><p class="card-offer">1일 패스 증정</p><p class="card-description">도쿄 여행 필수! 시부야, 지유가오카 등을 지나는 도큐 라인 1일 승차권 증정!</p><p class="card-expiry">✅ 상시 이벤트</p></div>
                        <div class="card-cta-button">✂️ 쿠폰 뒷면 보기</div>
                    </div>
                    <div class="card-face card-face--back">
                         <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-TOKYU" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe src="https://maps.google.com/maps?q=ADDRESS&z=15&output=embed4" loading="lazy"></iframe></div>
                        <div class="back-section"><h4>관련 정보</h4><ul class="back-info-list"><li><strong>📍 교환처:</strong> 시부야 역 등 도큐선 주요 역 창구</li><li><strong>⏰ 이용시간:</strong> 첫차부터 막차까지</li><li><strong>✨ 팁:</strong> 시모키타자와, 지유가오카 여행 시 필수!</li></ul></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 공유하기</button><button class="action-btn flip-back-btn"><-- 앞면으로</button></div>
                    </div>
                </div>
            </div>
            
            <div class="coupon-card-scene" data-category="electronics" data-expiry="2025-11-30">
                <div class="expiring-badge">마감임박</div>
                <div class="coupon-card">
                    <div class="card-face card-face--front">
                        <div class="card-image-wrapper"><img src="https://img.japankuru.com/prg_img/thumbnail1/img2023112417190332724100.png" alt="Yodobashi Camera 쿠폰"></div>
                        <div class="card-content"><h3 class="card-store-name">Yodobashi Camera</h3><p class="card-offer">최대 15% OFF</p><p class="card-description">면세 10% + 비자카드 결제 시 5% 추가 할인! 카메라, 가전, 게임까지.</p><p class="card-expiry">🕒 유효기간: 2025. 11. 30</p></div>
                        <div class="card-cta-button">✂️ 쿠폰 뒷면 보기</div>
                    </div>
                     <div class="card-face card-face--back">
                        <div class="back-qr-code"><img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=JK-Yodobashi" alt="QR Code"></div>
                        <div class="back-map-wrapper"><iframe src="https://maps.google.com/maps?q=ADDRESS&z=15&output=embed5" loading="lazy"></iframe></div>
                        <div class="back-section"><h4>관련 정보</h4><ul class="back-info-list"><li><strong>📍 주소:</strong> 도쿄도 치요다구 간다하나오카초 1-1</li><li><strong>⏰ 영업시간:</strong> 매일 09:30 - 22:00</li><li><strong>✨ 팁:</strong> 피규어와 굿즈는 6층에 모여있어요.</li></ul></div>
                        <div class="back-actions"><button class="action-btn share-btn">📣 공유하기</button><button class="action-btn flip-back-btn"><-- 앞면으로</button></div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-logo">JAPANKURU</div>
            <p>일본의 모든 것을 깊이 있게, Japankuru와 함께 하세요.</p>
            <div class="footer-links">
                <a href="#">회사소개</a>
                <a href="#">모든 쿠폰 보기</a>
                <a href="#">문의하기</a>
                <a href="#">개인정보처리방침</a>
            </div>
            <div class="footer-copyright">
                &copy; 2025 Japankuru. All Rights Reserved.
            </div>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const couponScenes = document.querySelectorAll('.coupon-card-scene');
        const filterButtons = document.querySelectorAll('.filter-btn');

        function checkExpiryDates() {
            const today = new Date();
            const threshold = 30 * 24 * 60 * 60 * 1000; // 30일

            couponScenes.forEach(scene => {
                const expiryDateStr = scene.dataset.expiry;
                if (expiryDateStr) {
                    const expiryDate = new Date(expiryDateStr);
                    const diff = expiryDate - today;
                    if (diff < threshold && diff > 0) {
                        scene.classList.add('is-expiring');
                    }
                }
            });
        }

        function setUpShareButtons() {
            document.querySelectorAll('.share-btn').forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.stopPropagation(); 
                    const card = button.closest('.coupon-card-scene');
                    const storeName = card.querySelector('.card-store-name').textContent;
                    const offer = card.querySelector('.card-offer').textContent;
                    
                    const shareData = {
                        title: `${storeName} 할인 쿠폰`,
                        text: `Japankuru에서 ${storeName} ${offer} 쿠폰을 확인하세요!`,
                        url: window.location.href
                    };
                    try {
                        if (navigator.share) {
                            await navigator.share(shareData);
                        } else {
                            alert('이 브라우저에서는 공유 기능을 지원하지 않습니다.\n페이지 주소를 복사하여 공유해주세요.');
                        }
                    } catch (err) {
                        console.error("Share failed:", err);
                    }
                });
            });
        }

        function updateFilterCounts() {
            filterButtons.forEach(button => {
                const filter = button.dataset.filter;
                const count = (filter === 'all') 
                    ? document.querySelectorAll('.coupon-card-scene').length
                    : document.querySelectorAll(`.coupon-card-scene[data-category="${filter}"]`).length;
                button.querySelector('.count').textContent = `(${count})`;
            });
        }
        
        couponScenes.forEach(scene => {
            scene.addEventListener('click', (e) => {
                if (!e.target.closest('a, iframe, .action-btn')) {
                     scene.classList.toggle('is-flipped');
                } else if (e.target.closest('.flip-back-btn')) {
                    scene.classList.remove('is-flipped');
                }
            });
        });

        const filterContainer = document.querySelector('.filter-controls');
        filterContainer.addEventListener('click', (event) => {
            const target = event.target.closest('.filter-btn');
            if (!target) return;

            document.querySelectorAll('.coupon-card-scene.is-flipped').forEach(flippedScene => {
                flippedScene.classList.remove('is-flipped');
            });
            
            filterButtons.forEach(btn => btn.classList.remove('active'));
            target.classList.add('active');

            const filter = target.dataset.filter;
            couponScenes.forEach(scene => {
                const category = scene.dataset.category;
                const shouldShow = filter === 'all' || category === filter;
                
                if (shouldShow) {
                    scene.classList.remove('is-hidden');
                    requestAnimationFrame(() => {
                        scene.classList.remove('is-hiding');
                    });
                } else {
                    scene.classList.add('is-hiding');
                    scene.addEventListener('transitionend', () => {
                        if (!scene.classList.contains('is-hiding')) return;
                        scene.classList.add('is-hidden');
                    }, { once: true });
                }
            });
        });

        checkExpiryDates();
        updateFilterCounts();
        setUpShareButtons();
    });
    </script>

</body>
</html>
